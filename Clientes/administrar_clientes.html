<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administrar Clientes - WichiPack</title>
  <link rel="stylesheet" href="../styles.css">
</head>

<body class="admin-body">
  <header class="admin-header">
    <h1 class="logo">WichiPack</h1>
    <button class="btn-volver" onclick="window.location.href='/Mainpage/admin.html'">‚Üê Volver</button>
  </header>

  <main class="admin-main">
    <div class="admin-content">
      <h2 class="titulo-seccion">Administrar Clientes</h2>
      <table class="tabla" id="tabla-clientes">
        <thead>
          <tr>
            <th>ID</th>
            <th>C√©dula</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Tel√©fono</th>
            <th>Correo</th>
            <th>Direcci√≥n</th>
          </tr>
        </thead>
        <tbody id="clientes-body">
          <!-- Los clientes se cargar√°n din√°micamente aqu√≠ -->
        </tbody>
      </table>
    </div>
  </main>

  <script type="module">
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        // üü¢ 1. Verificar sesi√≥n
        const token = localStorage.getItem("token");
        if (!token) {
          window.location.href = "/Login/index.html";
          return;
        }

        const response = await fetch("/api/auth", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "check", token: token}),
        });

        const result = await response.json();
        if (!response.ok) {
          console.warn(result.error || "Sesi√≥n no v√°lida");
          window.location.href = "/Login/index.html";
          return;
        }

        // üü¢ 2. Validar rol
        if (result.idrol === 2) {
          window.location.href = "/Mainpage/mantenimiento.html";
          return;
        }
      } catch (error) {
        console.error("Error al verificar la sesi√≥n:", error);
        window.location.href = "/Login/index.html";
      }
    });

  </script>
  <script src="main.js"></script>
</body>

</html>