<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Administrar Clientes - WichiPack</title>
  <link rel="stylesheet" href="../styles.css">
</head>
<body class="admin-body">
  <header class="admin-header">
    <h1 class="logo">WichiPack</h1>
    <button class="btn-volver" onclick="window.location.href='/Mainpage/admin.html'">‚Üê Volver</button>
  </header>

  <main class="admin-main">
    <div class="admin-content">
      <h2 class="titulo-seccion">Administrar Clientes</h2>
      <table class="tabla">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Correo</th>
            <th>Tel√©fono</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>Karla Ardila</td>
            <td>karla@example.com</td>
            <td>3101234567</td>
            <td><button class="btn-eliminar">Eliminar</button></td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
  <script type="module">
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        // üü¢ 1. Obtener el token guardado despu√©s del login
        const token = localStorage.getItem("token");

        if (!token) {
          // Si no hay token, redirigir al login
          window.location.href = "/Login/index.html";
          return;
        }

        // üü¢ 2. Enviar token al endpoint checkSession (ahora m√©todo POST)
        const response = await fetch("/api/checkSession", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token }),
        });

        const result = await response.json();

        // üü¢ 3. Si la sesi√≥n no es v√°lida, redirigir
        if (!response.ok) {
          console.warn(result.error || "Sesi√≥n no v√°lida");
          window.location.href = "/Login/index.html";
          return;
        }

        // üü¢ 4. Redirigir seg√∫n rol
        switch (result.idrol) {
          case 1:
            break;
          case 2:
            window.location.href = "/Mainpage/mantenimiento.html";
            break;
          case 3:
            break;
          default:
            alert("Rol desconocido. Contacta al administrador.");
        }
      } catch (error) {
        console.error("Error al verificar la sesi√≥n:", error);
        window.location.href = "/Login/index.html";
      }
    });
  </script>
</body>
</html>
